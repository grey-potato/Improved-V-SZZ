# é›†æˆV-SZZä½¿ç”¨è¯´æ˜

## ğŸ¯ åŠŸèƒ½

**è‡ªåŠ¨è¯†åˆ«BFC + V-SZZåˆ†æ**ï¼Œæ— éœ€æ‰‹åŠ¨æ ‡æ³¨ï¼

å°†LLMæ¨æ–­BFCå’ŒV-SZZå®Œå…¨é›†æˆï¼Œä¸€æ¡å‘½ä»¤æå®šï¼š
1. è‡ªåŠ¨æ‰«æä»“åº“æäº¤
2. è¯†åˆ«å®‰å…¨ä¿®å¤æäº¤(BFC)
3. å¯¹æ¯ä¸ªBFCè¿è¡ŒV-SZZ
4. è¾“å‡ºæ¼æ´å¼•å…¥æäº¤(BIC)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ€ç®€å•çš„æ–¹å¼

```bash
cd ICSE2022ReplicationPackage
python quick_analyze.py <ä»“åº“è·¯å¾„>
```

**ç¤ºä¾‹ï¼š**
```bash
# åˆ†æactivemqä»“åº“
python quick_analyze.py ..\repos\activemq

# è‡ªå®šä¹‰å‚æ•°ï¼šæ‰«æ500ä¸ªæäº¤ï¼Œåˆ†æ10ä¸ªBFC
python quick_analyze.py ..\repos\activemq 500 10
```

### å®Œæ•´å‘½ä»¤è¡Œ

```bash
python integrated_vszz.py <ä»“åº“è·¯å¾„> [é€‰é¡¹]
```

**é€‰é¡¹ï¼š**
- `--max-commits N`: æ‰«ææœ€è¿‘Nä¸ªæäº¤ (é»˜è®¤: 500)
- `--max-bfcs N`: æœ€å¤šåˆ†æNä¸ªBFC (é»˜è®¤: 10)
- `--min-score N`: BFCæœ€ä½åˆ†æ•° (é»˜è®¤: 10)
- `--use-llm`: ä½¿ç”¨LLMéªŒè¯BFC
- `--openai-key KEY`: OpenAI APIå¯†é’¥

**ç¤ºä¾‹ï¼š**
```bash
# åŸºæœ¬åˆ†æï¼ˆä¸ä½¿ç”¨LLMï¼‰
python integrated_vszz.py ..\repos\activemq

# ä½¿ç”¨LLMéªŒè¯
python integrated_vszz.py ..\repos\activemq --use-llm --openai-key sk-xxx

# è‡ªå®šä¹‰å‚æ•°
python integrated_vszz.py ..\repos\activemq --max-commits 1000 --max-bfcs 20 --min-score 15
```

---

## ğŸ“Š è¾“å‡ºç»“æœ

### æ–‡ä»¶ä½ç½®
ç»“æœä¿å­˜åœ¨ `integrated_results/` ç›®å½•ï¼š

```
integrated_results/
â”œâ”€â”€ activemq_20260112_143022.json        # JSONæ ¼å¼è¯¦ç»†ç»“æœ
â””â”€â”€ activemq_20260112_143022_report.txt  # å¯è¯»æ–‡æœ¬æŠ¥å‘Š
```

### JSONç»“æ„
```json
{
  "repository": {
    "name": "activemq",
    "path": "..."
  },
  "analysis_info": {
    "bfc_count": 5,
    "successful_analysis": 4,
    "total_bics": 12
  },
  "bfcs": [
    {
      "commit_hash": "abc123...",
      "message": "Fix security vulnerability",
      "score": 25,
      "bic_count": 3
    }
  ],
  "bic_mapping": {
    "abc123...": ["def456...", "ghi789..."]
  }
}
```

### æ–‡æœ¬æŠ¥å‘Šç¤ºä¾‹
```
================================================================================
V-SZZ åˆ†ææŠ¥å‘Š
================================================================================

ä»“åº“: activemq
æ—¶é—´: 20260112_143022

ç»Ÿè®¡ä¿¡æ¯:
  BFCæ•°é‡: 5
  æˆåŠŸåˆ†æ: 4
  æ€»BICæ•°: 12

================================================================================
è¯¦ç»†ç»“æœ
================================================================================

1. BFC: a1b2c3d4
   æ¶ˆæ¯: Fix CVE-2023-1234 - SQL injection vulnerability
   åˆ†æ•°: 30 (é«˜ä¼˜å…ˆçº§:cve; é«˜ä¼˜å…ˆçº§:vulnerability; ä¿®å¤ç±»)
   æ ¸å¿ƒæ–‡ä»¶: 3
     - src/main/UserService.java
     - src/main/DatabaseUtil.java
   BICæ•°é‡: 4
     1. e5f6g7h8
     2. i9j0k1l2
     ...
```

---

## ğŸ” å·¥ä½œæµç¨‹

```
1. æ‰«ææäº¤
   â†“
2. è¯†åˆ«BFCå€™é€‰
   - æ£€æŸ¥commit messageå…³é”®è¯
   - åˆ†æä»£ç æ¨¡å¼
   - è®¡ç®—åˆ†æ•°
   â†“
3. [å¯é€‰] LLMéªŒè¯
   - æ·±åº¦åˆ†æcommit
   - åˆ¤æ–­æ˜¯å¦çœŸçš„æ˜¯å®‰å…¨ä¿®å¤
   - è¾“å‡ºç½®ä¿¡åº¦
   â†“
4. V-SZZåˆ†æ
   - è·å–å—å½±å“æ–‡ä»¶
   - é€’å½’è¿½æº¯BIC
   - ä»£ç æ˜ å°„
   â†“
5. è¾“å‡ºç»“æœ
   - JSON + æ–‡æœ¬æŠ¥å‘Š
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### ä¸ä½¿ç”¨LLMï¼ˆé»˜è®¤ï¼‰
- åŸºäºè§„åˆ™è¯†åˆ«BFC
- å¿«é€Ÿã€å…è´¹
- å‡†ç¡®åº¦çº¦70-80%

### ä½¿ç”¨LLM
- éœ€è¦OpenAI API Key
- æ›´å‡†ç¡®ï¼ˆ85-95%ï¼‰
- æœ‰APIè°ƒç”¨æˆæœ¬

**è®¾ç½®API Keyæ–¹æ³•ï¼š**

**æ–¹æ³•1ï¼šç¯å¢ƒå˜é‡**
```powershell
$env:OPENAI_API_KEY="sk-your-key"
python integrated_vszz.py repo_path --use-llm
```

**æ–¹æ³•2ï¼šå‘½ä»¤è¡Œå‚æ•°**
```bash
python integrated_vszz.py repo_path --use-llm --openai-key sk-your-key
```

---

## ğŸ“ Pythonä»£ç è°ƒç”¨

```python
from integrated_vszz import IntegratedVSZZ

# åˆ›å»ºåˆ†æå™¨
analyzer = IntegratedVSZZ(
    repo_path='path/to/repo',
    llm_client=None  # æˆ–é…ç½®LLMå®¢æˆ·ç«¯
)

# æ‰§è¡Œåˆ†æ
result = analyzer.analyze_repository(
    max_commits=500,   # æ‰«æ500ä¸ªæäº¤
    max_bfcs=10,       # åˆ†æ10ä¸ªBFC
    min_score=10,      # æœ€ä½åˆ†æ•°10
    use_llm=False      # ä¸ä½¿ç”¨LLM
)

# è®¿é—®ç»“æœ
print(f"æ‰¾åˆ° {len(result['bfcs'])} ä¸ªBFC")
print(f"è¾“å‡ºæ–‡ä»¶: {result['output_file']}")
```

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### ç¬¬ä¸€æ¬¡ä½¿ç”¨
1. å…ˆç”¨å°å‚æ•°æµ‹è¯•ï¼š`--max-commits 100 --max-bfcs 3`
2. æ£€æŸ¥ç»“æœæ˜¯å¦åˆç†
3. é€æ­¥å¢åŠ å‚æ•°

### å¤§å‹ä»“åº“
- åˆ†æ‰¹åˆ†æï¼šæ¯æ¬¡500ä¸ªæäº¤
- é™åˆ¶BFCæ•°é‡ï¼šé¿å…æ—¶é—´è¿‡é•¿
- ä½¿ç”¨`--min-score`è¿‡æ»¤ä½åˆ†å€™é€‰

### æé«˜å‡†ç¡®åº¦
- é™ä½`--min-score`ï¼šå‘ç°æ›´å¤šå€™é€‰
- ä½¿ç”¨`--use-llm`ï¼šæé«˜éªŒè¯å‡†ç¡®åº¦
- ç»“åˆäººå·¥å®¡æŸ¥ï¼šæ£€æŸ¥é«˜åˆ†å€™é€‰

### æˆæœ¬æ§åˆ¶
- ä¸ä½¿ç”¨LLMï¼šå®Œå…¨å…è´¹
- ä½¿ç”¨LLMï¼šé™åˆ¶`--max-bfcs`æ•°é‡
- GPT-4: çº¦$0.03/BFCéªŒè¯

---

## â“ å¸¸è§é—®é¢˜

**Q: æ²¡æœ‰æ‰¾åˆ°BFCæ€ä¹ˆåŠï¼Ÿ**
- é™ä½`--min-score`é˜ˆå€¼ï¼ˆå¦‚æ”¹ä¸º5ï¼‰
- å¢åŠ `--max-commits`æ‰«æèŒƒå›´
- æ£€æŸ¥ä»“åº“æ˜¯å¦æœ‰å®‰å…¨ç›¸å…³æäº¤

**Q: V-SZZåˆ†æå¤±è´¥ï¼Ÿ**
- æ£€æŸ¥ASTMapEval_jaræ˜¯å¦å­˜åœ¨
- ç¡®è®¤ä»“åº“è¯­è¨€æ”¯æŒï¼ˆJava/C/C++ï¼‰
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—

**Q: ç»“æœä¸å‡†ç¡®ï¼Ÿ**
- ä½¿ç”¨`--use-llm`æé«˜BFCè¯†åˆ«å‡†ç¡®åº¦
- å¢åŠ `--min-score`åªåˆ†æé«˜åˆ†å€™é€‰
- äººå·¥å®¡æŸ¥ç»“æœ

**Q: åˆ†æå¾ˆæ…¢ï¼Ÿ**
- å‡å°‘`--max-commits`
- å‡å°‘`--max-bfcs`
- V-SZZåˆ†ææ¯ä¸ªBFCéœ€è¦1-5åˆ†é’Ÿ

---

## ğŸ”§ è°ƒè¯•æ¨¡å¼

```python
# åªè¯†åˆ«BFCï¼Œä¸è¿è¡ŒV-SZZ
from integrated_vszz import IntegratedVSZZ

analyzer = IntegratedVSZZ('repo_path')
bfcs = analyzer._identify_bfcs(max_commits=100, min_score=10)

# æŸ¥çœ‹å€™é€‰
for bfc in bfcs[:5]:
    print(f"{bfc['short_hash']}: {bfc['message'][:50]}")
    print(f"  åˆ†æ•°: {bfc['score']} - {bfc['reason']}")
```

---

## ğŸ“š è¿›é˜¶ä½¿ç”¨

### æ‰¹é‡åˆ†æå¤šä¸ªä»“åº“

```python
repos = [
    'path/to/repo1',
    'path/to/repo2',
    'path/to/repo3'
]

for repo in repos:
    print(f"\nåˆ†æ {os.path.basename(repo)}...")
    analyzer = IntegratedVSZZ(repo)
    result = analyzer.analyze_repository(
        max_commits=300,
        max_bfcs=5
    )
```

### è‡ªå®šä¹‰BFCè¯„åˆ†è§„åˆ™

ç¼–è¾‘ `integrated_vszz.py` ä¸­çš„ `_score_commit` æ–¹æ³•ï¼š
- è°ƒæ•´å…³é”®è¯å’Œåˆ†æ•°
- æ·»åŠ æ–°çš„ä»£ç æ¨¡å¼
- ä¿®æ”¹è¿‡æ»¤é€»è¾‘

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿ
1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
2. æ£€æŸ¥ä»“åº“è·¯å¾„å’Œæƒé™
3. ç¡®è®¤ä¾èµ–åŒ…å·²å®‰è£…
4. å‚è€ƒæ–‡æ¡£å’Œç¤ºä¾‹ä»£ç 
